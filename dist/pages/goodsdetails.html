<!DOCTYPE html><html><head><meta charset="UTF-8"><title>海淘易购-商品详情-轻奢海淘电商</title><link rel="stylesheet" href="../css/goodsdetails.css"><link rel="stylesheet" href="../css/public.css"><style>.welcome{display: none;}</style></head><body><!-- <h1>这是商品详情</h1> --><!-- banner_wrap --><div class="banner_wrap"><!-- banner --><div class="banner"><div class="left"><a href="#">收藏海淘易购</a> &nbsp;| &nbsp;<a href="#">购物攻略&nbsp;</a> <i><span class="iconfont">&#xe630;</span>&nbsp;000-1661888</i></div><div class="right"><a href="pages/login.html" class="login">登录&nbsp;&nbsp;</a> <a href="pages/register.html" class="login1"><span class="span">注册送88元&nbsp;</span></a> &nbsp;| &nbsp;<div class="welcome"><span><d>欢迎您，</d><em id="userName"></em> <span id="logout"><a href="#">&nbsp;&nbsp;安全退出</a></span></span></div><span class="iconfont">&#xe60e;</span>&nbsp;购物车<i class="i">0</i>件商品&nbsp; <a href="#">我的订单</a></div></div></div><!-- top --><div class="top"><img src="../static/logo.png" alt=""><div class="logo"><p>海淘易购</p><p>HTYG.COM</p></div><div class="search"><input type="text " placeholder="输入海外商品网址或关键词，见证奇迹一刻！"> <button class="btn">搜索</button><ul><li>热门：</li><li><a href="#">美亚&nbsp;/&nbsp;</a></li><li><a href="#">日亚&nbsp;/&nbsp;</a></li><li><a href="#">6pm&nbsp;/&nbsp;</a></li><li><a href="#">卡特&nbsp;/&nbsp;</a></li><li><a href="#">拉夫劳伦&nbsp;/&nbsp;</a></li><li><a href="#">zappos&nbsp;/&nbsp;</a></li><li><a href="#">维密&nbsp;/&nbsp;</a></li><li><a href="#">橘润&nbsp;/&nbsp;</a></li><li><a href="#">凯特丝蓓&nbsp;/&nbsp;</a></li><li><a href="#">shopbop</a></li></ul><p class="p1"><a href="#">更多&nbsp;|&nbsp;</a></p><p class="p2"><a href="#">使用教程</a></p></div></div><!-- nav_wrap --><div class="nav_wrap"><!-- nav --><div class="nav"><div class="box"><a href="#">商品分类列表</a></div><ul><li><a href="#">启航</a></li><li><a href="#">每日专题</a></li><li><a href="#">优选</a></li><li><a href="#">一键购</a></li><li><a href="#">品牌街</a></li><li><a href="#">手机客户端</a></li></ul></div></div><div class="cont"></div><!-- 底部 --><div class="bottom_wrap"><div class="bottom"><ul class="ul"><a href="#"><li><p class="p1"><span class="iconfont">&#xe603;</span></p><p class="p2">海外正品</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xe72a;</span></p><p class="p2">海外直发</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xe654;</span></p><p class="p2">免服务费</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xeb1a;</span></p><p class="p2">关税补贴</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xe600;</span></p><p class="p2">极速发货</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xe623;</span></p><p class="p2">便捷支付</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xe653;</span></p><p class="p2">七天退货</p></li></a><a href="#"><li><p class="p1"><span class="iconfont">&#xe625;</span></p><p class="p2">全程物流追踪</p></li></a></ul><img src="../static/erweima.png" alt="" class="erweima"><div class="footer"><ul class="ul1"><li class="li1">新手指南</li><a href="#"><li>购物流程</li></a><a href="#"><li>支付方式</li></a><a href="#"><li>运费明细</li></a></ul><ul class="ul1"><li class="li1">淘购指南</li><a href="#"><li>尺码换算</li></a><a href="#"><li>关税查询</li></a></ul><ul class="ul1"><li class="li1">购物保障</li><a href="#"><li>正品保障</li></a><a href="#"><li>七天退货</li></a><a href="#"><li>关税补助</li></a><a href="#"><li>极速发货</li></a></ul><ul class="ul1"><li class="li1">海淘助手</li><a href="#"><li>包裹查询</li></a><a href="#"><li>服务协议</li></a></ul><ul class="ul1"><li class="li1">关于我们</li><a href="#"><li>海淘易购简介</li></a><a href="#"><li>加入我们</li></a><a href="#"><li>联系我们</li></a></ul><ul class="ul1"><li class="li1">联系我们</li><a href="#"><li><span class="iconfont">&#xe8bb;</span></li></a><a href="#"><li><span class="iconfont">&#xe604;</span></li></a><a href="#"><li><span class="iconfont">&#xe631;</span></li></a></ul><div class="copyright">Copyright©2000-2020 京ICP备66668888号-1 京公网安备11223344556677889900号</div></div></div></div></body><script src="../js/jquery.js"></script><script src="../js/jquery.banner.1.0.js"></script><script src="../js/ajax-promise.js"></script><script>class Index{
            constructor(){
                this.login = document.querySelector(".login");
                this.login1 = document.querySelector(".login1");
                this.welcome = document.querySelector(".welcome");
                this.logout = document.getElementById("logout");
                this.uName = document.getElementById("userName")
    
                // 对于需要验证是否登录的页面来说，应该立即获取是否登录的信息
                this.init();
                this.addEvent();
            }
            init(){
                // 获取之后，简单处理数据
                this.m = sessionStorage.getItem("userMsg");
                this.m = this.m ? JSON.parse(this.m) : {};
                // 如果有登录成功后的信息
                if(this.m.user){
                    // 显示登录的用户名
                    this.uName.innerHTML = this.m.user;
                    // 显示欢迎信息
                    this.login.style.display = "none";
                    this.login1.style.display = "none";
                    // 隐藏登录注册操作
                    this.welcome.style.display = "block";
                    
                }else{
                    location.href = "login.html";

                }
            }
            addEvent(){
                // 注销功能，就是抹掉登录成功之后的信息
                this.logout.onclick = function(){
                    sessionStorage.removeItem("userMsg");
                    location.href = "../index.html";
                }
            }
        }
        new Index;

    // 难点：两个html如何传递数据，url，使用location解析
    // console.log(location.search.slice(1).split("=")[1]);

    class Details{
        constructor(){
            this.cont = document.querySelector(".cont");
            this.url = "../data/goods.json";

            this.load();
            this.getId();
        }
        getId(){
            // 获取地址栏的url后拼接的数据
            this.id = location.search.slice(1).split("=")[1];
        }
        load(){
            // 请求商品数据库：json
            ajax({
                url:this.url
            }).then((res)=>{
                this.res = JSON.parse(res);
                this.display();
            })
        }
        display(){
            // 将接收到的商品id和商品数据中的id作比较
            this.res.forEach(val => {
                if(val.goodsId === this.id){
                    console.log(val);
                    // 根据val的数据内容化，渲染商品详情页
                    this.cont.innerHTML = "hello";
                    this.cont.innerHTML = `
                    <div class="magnifier">
                        <div class="s_box">
                            <img src="${val.img.largeImg[0]}" alt="">
                            <span></span>
                            <p class="mask"></p>
                        </div>
                        <div class="b_box">
                            <img src="${val.img.largeImg[0]}" alt="">
                        </div>
                        <span class="clear"></span>
                        <ul class="list">
                            ${this.createLi(val.img.smallImg)}
                        </ul>
                    </div>
                    <div class="goodsMsg">
                        <h3>${val.name}</h3>
                        <p>价格：<span>${val.price}</span></p>
                        <p>品牌：<span>${val.brand}</span></p>
                        <p>上架时间：<span>${val.uptime}</span></p>
                        <p>名称：<span>${val.title}</span></p>
                        <p>商品编号：<span>${val.goodsId}</span></p>
                    </div>`;
                    // 页面渲染完成后，可以执行放大镜的效果了
                    // 执行放大镜时，将遍历到的数据，传入，方便切换大图
                    new Large(val.img);
                }
            });
        }
        createLi(arr){
            // 根据小图的数量生成对应的结构的功能
            let str = "";
            for(let i=0;i<arr.length;i++){
                str += `<li><img src="${arr[i]}" alt=""></li>`
            }
            return str;
        }
    }
    new Details;

    // 注意：70行代码，功能：用来充当小滑块和鼠标之间的隔板，解决小滑块抖动的问题
    // 注意：77行代码，功能：根据小图的数量生成对应的结构




    class Large{
        constructor(imgData){
            this.sBox = document.querySelector(".s_box");
            this.sImg = document.querySelector(".s_box img");
            this.sSpan = document.querySelector(".s_box span");
            this.bBox = document.querySelector(".b_box");
            this.bImg = document.querySelector(".b_box img");
            this.li = document.querySelectorAll(".list li");

            this.imgData = imgData;
            
            this.addEvent();
        }
        addEvent(){
            var that = this;
            this.sBox.onmouseover = function(){
                that.over();
            }
            this.sBox.onmousemove = function(eve){
                var e = eve || window.event;
                that.move(e);
            }
            this.sBox.onmouseout = function(){
                that.out();
            }
            for(let i=0;i<this.li.length;i++){
                this.li[i].onmouseover = function(){
                    that.sImg.src = that.imgData.largeImg[i];
                    that.bImg.src = that.imgData.largeImg[i];
                }
            }
        }
        over(){
            this.sSpan.style.display = "block";
            this.bBox.style.display = "block";
        }
        move(e){
            // 因为页面结构日渐复杂，所以将pageX改回offsetX，但是灰色小滑块会抖，解决方式，纯布局结局
            var l = e.offsetX - this.sSpan.offsetWidth/2;
            var t = e.offsetY - this.sSpan.offsetHeight/2;
            if(l<0) l=0;
            if(t<0) t=0;
            if(l > this.sBox.offsetWidth - this.sSpan.offsetWidth){
                l = this.sBox.offsetWidth - this.sSpan.offsetWidth;
            }
            if(t > this.sBox.offsetHeight - this.sSpan.offsetHeight){
                t = this.sBox.offsetHeight - this.sSpan.offsetHeight;
            }
            this.sSpan.style.left = l + "px";
            this.sSpan.style.top = t + "px";
            var x = l / (this.sBox.offsetWidth - this.sSpan.offsetWidth);
            var y = t / (this.sBox.offsetHeight - this.sSpan.offsetHeight);
            this.bImg.style.left = (this.bBox.offsetWidth - this.bImg.offsetWidth) * x + "px";
            this.bImg.style.top = (this.bBox.offsetHeight - this.bImg.offsetHeight) * y + "px";
        }
        out(){
            this.sSpan.style.display = "none";
            this.bBox.style.display = "none";
        }
    }</script></html>